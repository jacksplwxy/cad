import{_ as e,r as t,o as i,a as s,e as a,g as n,w as l,h as o,n as r,p as h,f as u,b as d,F as g,i as c}from"./index-CBIm98R_.js";class RichText{constructor(e,t,i={}){this.container=e,this.data=t,this.options=Object.assign({pageWidth:794,pageHeight:1123,pagePadding:[100,120,100,120],pageMargin:20,pagePaddingIndicatorSize:35,pagePaddingIndicatorColor:"#BABABA",color:"#333",fontSize:16,fontFamily:"Yahei",lineHeight:1.5,rangeColor:"#bbdfff",rangeOpacity:.6},i),this.pageCanvasList=[],this.pageCanvasCtxList=[],this.rows=[],this.positionList=[],this.cursorPositionIndex=-1,this.cursorEl=null,this.cursorTimer=null,this.textareaEl=null,this.isCompositing=!1,this.isMousedown=!1,this.range=[],this.mousemoveTimer=null,this.listeners={mousedown:null,rangeChange:null},this.createPage(0),this.render(),document.body.addEventListener("mousemove",this.onMousemove.bind(this)),document.body.addEventListener("mouseup",this.onMouseup.bind(this))}render(e){this.clear(),this.positionList=[],e||(this.rows=[],this.computeRows()),this.renderPage()}clear(){let{pageWidth:e,pageHeight:t}=this.options;this.pageCanvasCtxList.forEach((i=>{i.clearRect(0,0,e,t)}))}renderPage(){let{pageHeight:e,pagePadding:t}=this.options,i=e-t[0]-t[2],s=0,a=this.pageCanvasCtxList[s],n=0;this.renderPagePaddingIndicators(s),this.rows.forEach(((e,t)=>{if(n+e.height>i){s++,this.pageCanvasList[s]||this.createPage(s),this.renderPagePaddingIndicators(s),a=this.pageCanvasCtxList[s],n=0}this.renderRow(a,n,e,s,t),n+=e.height}))}renderRow(e,t,i,s,a){let{color:n,pagePadding:l,rangeColor:o,rangeOpacity:r}=this.options,h=l[3],u=l[0],d=h;t+=u,i.elementList.forEach((l=>{if(this.positionList.push({...l,pageIndex:s,rowIndex:a,rect:{leftTop:[d,t],leftBottom:[d,t+i.height],rightTop:[d+l.info.width,t],rightBottom:[d+l.info.width,t+i.height]}}),"\n"!==l.value){if(e.save(),l.background&&(e.save(),e.beginPath(),e.fillStyle=l.background,e.fillRect(d,t,l.info.width,i.height),e.restore()),l.underline&&(e.save(),e.beginPath(),e.moveTo(d,t+i.height),e.lineTo(d+l.info.width,t+i.height),e.stroke(),e.restore()),l.linethrough&&(e.save(),e.beginPath(),e.moveTo(d,t+i.height/2),e.lineTo(d+l.info.width,t+i.height/2),e.stroke(),e.restore()),e.font=l.font,e.fillStyle=l.color||n,e.fillText(l.value,d,t+i.height-(i.height-i.originHeight)/2-i.descent),2===this.range.length&&this.range[0]!==this.range[1]){let s=this.getRange(),a=this.positionList.length-1;a>=s[0]&&a<=s[1]&&(e.save(),e.beginPath(),e.globalAlpha=r,e.fillStyle=o,e.fillRect(d,t,l.info.width,i.height),e.restore())}d+=l.info.width,e.restore()}}))}getRange(){return this.range.length<2?[]:this.range[1]>this.range[0]?[this.range[0]+1,this.range[1]]:this.range[1]<this.range[0]?[this.range[1]+1,this.range[0]]:[]}clearRange(){this.range.length>0&&(this.range=[],this.render())}computeRows(){let{pageWidth:e,pagePadding:t,lineHeight:i,fontSize:s}=this.options,a=e-t[1]-t[3];const n=document.createElement("canvas").getContext("2d");let l=[];l.push({width:0,height:0,originHeight:0,descent:0,elementList:[]}),this.data.forEach((e=>{let{value:t,lineheight:o}=e,r=o||i,h=this.getFontStr(e),u={width:0,height:0,ascent:0,descent:0};if("\n"===t)u.height=s;else{n.font=h;let{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s}=n.measureText(t);u.width=e,u.height=i+s,u.ascent=i,u.descent=s}let d={...e,info:u,font:h},g=l[l.length-1];g.width+u.width<=a&&"\n"!==t?(g.elementList.push(d),g.width+=u.width,g.height=Math.max(g.height,u.height*r),g.originHeight=Math.max(g.originHeight,u.height),g.descent=Math.max(g.descent,u.descent)):l.push({width:u.width,height:u.height*r,originHeight:u.height,elementList:[d],descent:u.descent})})),this.rows=l}getFontStr(e){let{fontSize:t,fontFamily:i}=this.options;return`${e.italic?"italic ":""} ${e.bold?"bold ":""} ${e.size||t}px  ${e.fontfamily||i} `}createPage(e){let{pageWidth:t,pageHeight:i,pageMargin:s}=this.options,a=document.createElement("canvas");const n=window.devicePixelRatio;a.width=t*n,a.height=i*n,a.style.width=t+"px",a.style.height=i+"px",a.style.cursor="text",a.style.backgroundColor="#fff",a.style.boxShadow="#9ea1a566 0 2px 12px",a.style.marginBottom=s+"px",a.addEventListener("mousedown",(t=>{this.onMousedown(t,e)})),this.container.appendChild(a);let l=a.getContext("2d");l.scale(n,n),this.pageCanvasList.push(a),this.pageCanvasCtxList.push(l)}onMousedown(e,t){this.isMousedown=!0;let{x:i,y:s}=this.windowToCanvas(e,this.pageCanvasList[t]),a=this.getPositionByPos(i,s,t);this.cursorPositionIndex=a,this.computeAndRenderCursor(a,t),this.range[0]=a,this.listeners.mousedown&&this.listeners.mousedown(a)}onMousemove(e){this.mousemoveEvent=e,this.mousemoveTimer||(this.mousemoveTimer=setTimeout((()=>{if(this.mousemoveTimer=null,!this.isMousedown)return;e=this.mousemoveEvent;let t=this.getPosInPageIndex(e.clientX,e.clientY);if(-1===t)return;let{x:i,y:s}=this.windowToCanvas(e,this.pageCanvasList[t]),a=this.getPositionByPos(i,s,t);-1!==a&&(this.range[1]=a,this.listeners.rangeChange&&this.listeners.rangeChange(this.getRange()),Math.abs(this.range[1]-this.range[0])>0&&(this.cursorPositionIndex=-1,this.hideCursor()),this.render(!0))}),100))}onMouseup(){this.isMousedown=!1}getPositionByPos(e,t,i){for(let a=0;a<this.positionList.length;a++){let s=this.positionList[a];if(s.pageIndex===i&&(e>=s.rect.leftTop[0]&&e<=s.rect.rightTop[0]&&t>=s.rect.leftTop[1]&&t<=s.rect.leftBottom[1]))return e<s.rect.leftTop[0]+s.info.width/2?a-1:a}let s=-1;for(let a=0;a<this.positionList.length;a++){let e=this.positionList[a];e.pageIndex===i&&(t>=e.rect.leftTop[1]&&t<=e.rect.leftBottom[1]&&(s=a))}if(-1!==s)return s;for(let a=0;a<this.positionList.length;a++){this.positionList[a].pageIndex===i&&(s=a)}return s}getCursorInfo(e){let t=this.positionList[e],{fontSize:i,pagePadding:s,lineHeight:a}=this.options,n=(t?t.size:null)||i,l=n+n/2;if(!t){if(this.positionList[e+1]){let t=this.getCursorInfo(e+1);return{x:s[3],y:t.y,height:t.height}}return{x:s[3],y:s[0]+(n*a-l)/2,height:l}}let o="\n"===t.value,r=this.rows[t.rowIndex];return{x:o?t.rect.leftTop[0]:t.rect.rightTop[0],y:t.rect.rightTop[1]+r.height-(r.height-r.originHeight)/2-l+(l-Math.max(n,t.info.height))/2,height:l}}computeAndRenderCursor(e,t){let i=this.getCursorInfo(e),s=this.canvasToContainer(i.x,i.y,this.pageCanvasList[t]);this.setCursor(s.x,s.y,i.height)}setCursor(e,t,i){this.clearRange(),clearTimeout(this.cursorTimer),this.cursorEl||(this.cursorEl=document.createElement("div"),this.cursorEl.style.position="absolute",this.cursorEl.style.width="1px",this.cursorEl.style.backgroundColor="#000",this.container.appendChild(this.cursorEl)),this.cursorEl.style.left=e+"px",this.cursorEl.style.top=t+"px",this.cursorEl.style.height=i+"px",this.cursorEl.style.opacity=1,setTimeout((()=>{this.focus(),this.cursorEl.style.display="block",this.blinkCursor(0)}),0)}hideCursor(){clearTimeout(this.cursorTimer),this.cursorEl.style.display="none"}blinkCursor(e){this.cursorTimer=setTimeout((()=>{this.cursorEl.style.opacity=e,this.blinkCursor(0===e?1:0)}),600)}focus(){this.textareaEl||(this.textareaEl=document.createElement("textarea"),this.textareaEl.style.position="fixed",this.textareaEl.style.left="-99999px",this.textareaEl.addEventListener("input",this.onInput.bind(this)),this.textareaEl.addEventListener("compositionstart",(()=>{this.isCompositing=!0})),this.textareaEl.addEventListener("compositionend",(()=>{this.isCompositing=!1})),this.textareaEl.addEventListener("keydown",this.onKeydown.bind(this)),this.textareaEl.addEventListener("blur",(()=>{this.hideCursor()})),document.body.appendChild(this.textareaEl)),this.textareaEl.focus()}blur(){this.textareaEl&&this.textareaEl.blur()}onInput(e){setTimeout((()=>{let t=e.data;if(!t||this.isCompositing)return;let i=t.split(""),s=i.length;this.getRange().length>0&&this.delete();let a=this.positionList[this.cursorPositionIndex];this.data.splice(this.cursorPositionIndex+1,0,...i.map((e=>({...a||{},value:e})))),this.render(),this.cursorPositionIndex+=s,this.computeAndRenderCursor(this.cursorPositionIndex,this.positionList[this.cursorPositionIndex].pageIndex)}),0)}onKeydown(e){8===e.keyCode?this.delete():13===e.keyCode&&this.newLine()}delete(){if(this.cursorPositionIndex<0){let e=this.getRange();if(!(e.length>0))return;{let t=e[1]-e[0]+1;this.data.splice(e[0],t),this.cursorPositionIndex=e[0]-1}}else this.data.splice(this.cursorPositionIndex,1),this.render(),this.cursorPositionIndex--;let e=this.positionList[this.cursorPositionIndex];this.computeAndRenderCursor(this.cursorPositionIndex,e?e.pageIndex:0)}newLine(){this.data.splice(this.cursorPositionIndex+1,0,{value:"\n"}),this.render(),this.cursorPositionIndex++;let e=this.positionList[this.cursorPositionIndex];this.computeAndRenderCursor(this.cursorPositionIndex,e.pageIndex)}getPosInPageIndex(e,t){let{left:i,top:s,right:a,bottom:n}=this.container.getBoundingClientRect();if(e<i||e>a||t<s||t>n)return-1;let{pageHeight:l,pageMargin:o}=this.options,r=t-s+this.container.scrollTop;for(let h=0;h<this.pageCanvasList.length;h++){let e=h*(l+o);if(r>=e&&r<=e+l)return h}return-1}windowToCanvas(e,t){let{left:i,top:s}=t.getBoundingClientRect();return{x:e.clientX-i,y:e.clientY-s}}canvasToContainer(e,t,i){return{x:e+i.offsetLeft,y:t+i.offsetTop}}renderPagePaddingIndicators(e){let t=this.pageCanvasCtxList[e];if(!t)return;let{pageWidth:i,pageHeight:s,pagePaddingIndicatorColor:a,pagePadding:n,pagePaddingIndicatorSize:l}=this.options;t.save(),t.strokeStyle=a,[[[n[3],n[0]-l],[n[3],n[0]],[n[3]-l,n[0]]],[[i-n[1],n[0]-l],[i-n[1],n[0]],[i-n[1]+l,n[0]]],[[n[3],s-n[2]+l],[n[3],s-n[2]],[n[3]-l,s-n[2]]],[[i-n[1],s-n[2]+l],[i-n[1],s-n[2]],[i-n[1]+l,s-n[2]]]].forEach((e=>{e.forEach(((i,s)=>{0===s?(t.beginPath(),t.moveTo(...i)):t.lineTo(...i),s>=e.length-1&&t.stroke()}))})),t.restore()}}let p="茫茫人海中，我，与你相遇。\n我为青莲，你为梵音，一眸擦肩，惊艳了五百年的时光。\n你，正值盛年，带着满身的荣耀，缓缓而归。而我，经了长长的漂泊，翻山越岭，终于，来到了你的身边。\n始终相信，遇见是上天最美的恩赐。也许，今生，我就是为寻你而来。\n寒来暑往，春秋交替，指针从未停过脚步，多少人事早已面目全非。然，十五个春秋，你依然在我心中。年少时，你是我心中的梦；长大后，你是我坚持的动力；而现在，你将伴我赢得人生。\n每天来往的路上，我都会看见属于你的身影。那时的我在想，何时，我才能骄傲的站在你面前，与你携手，并肩作战。于是，我站在了梦想的道路上。早已习惯伴着朦胧的月色起床，也早已习惯回家的路上与星月作伴；早已将厚厚的试卷当做人生的挚友，也早已将一次次模拟云淡风轻；早已习惯从讲台上那个人嘴里说出你的名字，也早已习惯你出现在我每晚的梦中。\n终于，我拿到了那张薄薄的纸，但，如千斤重。因为，那上面，有我的苦我的泪，亦有我的幸福我的希望。我知道，我终能来到你的身旁。\n你，经历了七十年的风雨，从懵懂无知的少年，到志在天下的青年，到如今成熟稳重的中年。我知道，你也流过泪水，你也经过挫折，你也想过放弃，但，你没有。\n你，是多少人心中的梦，从1945到2015，你用不断的成长铸就了我们心中的天堂，如今的你饱经风霜，看淡世事，以遗世独立之姿傲立山巅。\n七十年前，你诞生于二战后，仿佛要连接两个时代，七十年后，我坚信，你将继续书写辉煌。\n于万千的人群中，于无际涯的时光里，没有早一步，也没有晚一步，我恰奔赴至你的人生之巅，这何尝不是一种深深的缘。\n你邯郸一中，拥有优秀博学的教师队伍，拥有勤奋刻苦的莘莘学子，拥有最优秀的教学设施，拥有最广阔的校园环境。在你的身边，我将度过三年青葱时光，我将看你书写三年辉煌。\n你，为我注入金色的理想，赋予我腾飞的力量。相信我，我定会努力飞翔，为你下一个百年，贡献出自己的力量。".split("").map(((e,t)=>{switch(t){case 6:return{value:e,color:"#7ec699",size:30};case 50:return{value:e,background:"#409EFF"};case 60:case 61:case 62:case 63:case 64:case 65:case 66:case 67:case 68:case 69:return{value:e,bold:!0};case 88:case 89:case 90:case 91:return{value:e,italic:!0,lineheight:3,background:"#E6A23C"};case 199:case 200:case 201:case 202:return{value:e,underline:!0};case 250:case 251:case 252:case 253:case 254:case 255:return{value:e,linethrough:!0};case 304:case 305:case 306:return{value:e,color:"rgb(246, 96, 0)",size:20,fontfamily:"cursive"};case 505:case 506:case 507:return{value:e,color:"rgb(30, 127, 255)",size:24,fontfamily:"黑体"};default:return{value:e}}}));const _withScopeId=e=>(h("data-v-61fb961d"),e=e(),u(),e),v={class:"container"},f={class:"toolbar"},m=[_withScopeId((()=>a("i",null,null,-1)))],b=[_withScopeId((()=>a("i",null,null,-1)))],x=[_withScopeId((()=>a("i",null,null,-1)))],C=[_withScopeId((()=>a("i",null,null,-1)))],y=[_withScopeId((()=>a("i",null,null,-1)))],w=[_withScopeId((()=>a("i",null,null,-1)))],P=e({__name:"index",setup(e){const h=t(null);let u=null;i((()=>{u=new RichText(h.value,p),u.listeners.mousedown=e=>{checkStyle(u.data[e])},u.listeners.rangeChange=e=>{if(e.length>0){let{color:t,fontFamily:i}=u.options,s=u.data[e[0]];L.value=s.fontfamily||i,M.value=s.color||t,H.value=s.background||"";let a=!0,n=!0,l=!0,o=!0;for(let r=e[0];r<=e[1];r++){let e=u.data[r];e.bold||(a=!1),e.italic||(n=!1),e.underline||(l=!1),e.linethrough||(o=!1)}k.value=a,T.value=n,z.value=l,R.value=o}}}));const checkStyle=e=>{let{color:t,fontFamily:i,lineHeight:s}=u.options;L.value=e.fontfamily||i,k.value=!!e.bold,T.value=!!e.italic,z.value=!!e.underline,R.value=!!e.linethrough,M.value=e.color||t,H.value=e.background||"",B.value=e.lineheight||s},P=[{label:"微软雅黑",value:"Yahei"},{label:"宋体",value:"宋体"},{label:"黑体",value:"黑体"},{label:"仿宋",value:"仿宋"},{label:"楷体",value:"楷体"},{label:"华文琥珀",value:"华文琥珀"},{label:"华文楷体",value:"华文楷体"},{label:"华文隶书",value:"华文隶书"},{label:"华文新魏",value:"华文新魏"},{label:"华文行楷",value:"华文行楷"},{label:"华文中宋",value:"华文中宋"},{label:"华文彩云",value:"华文彩云"},{label:"Arial",value:"Arial"},{label:"Segoe UI",value:"Segoe UI"},{label:"Ink Free",value:"Ink Free"},{label:"Fantasy",value:"Fantasy"}],E=[{label:"1",value:1},{label:"1.25",value:1.25},{label:"1.5",value:1.5},{label:"1.75",value:1.75},{label:"2",value:2},{label:"2.5",value:2.5},{label:"3",value:3}],I=t(["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"]),L=t("Yahei"),k=t(!1),T=t(!1),z=t(!1),R=t(!1),M=t(""),H=t(""),B=t(1.5),exec=e=>{let t=u.getRange();if(t.length>0){"bold"===e?k.value=!k.value:"italic"===e?T.value=!T.value:"underline"===e?z.value=!z.value:"linethrough"===e&&(R.value=!R.value);for(let i=t[0];i<=t[1];i++){let t=u.data[i];switch(e){case"fontFamily":t.fontfamily=L.value;break;case"sizeAdd":t.size=(t.size||u.options.fontSize)+1;break;case"sizeMinus":t.size=(t.size||u.options.fontSize)-1;break;case"bold":t.bold=k.value;break;case"italic":t.italic=T.value;break;case"underline":t.underline=z.value;break;case"linethrough":t.linethrough=R.value;break;case"color":t.color=M.value;break;case"background":t.background=H.value;break;case"lineHeight":t.lineheight=B.value}}}u.render()};return(e,t)=>{const i=o("el-option"),u=o("el-select"),p=o("el-color-picker");return d(),s("div",v,[a("div",f,[n(u,{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=e=>L.value=e),size:"small",style:{width:"100px","margin-right":"6px"},onChange:t[1]||(t[1]=e=>exec("fontFamily"))},{default:l((()=>[(d(),s(g,null,c(P,(e=>n(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"]),a("div",{class:"btn sizeAdd",onClick:t[2]||(t[2]=e=>exec("sizeAdd"))},m),a("div",{class:"btn sizeMinus",onClick:t[3]||(t[3]=e=>exec("sizeMinus"))},b),a("div",{class:r(["btn bold",{active:k.value}]),onClick:t[4]||(t[4]=e=>exec("bold"))},x,2),a("div",{class:r(["btn italic",{active:T.value}]),onClick:t[5]||(t[5]=e=>exec("italic"))},C,2),a("div",{class:r(["btn underline",{active:z.value}]),onClick:t[6]||(t[6]=e=>exec("underline"))},y,2),a("div",{class:r(["btn linethrough",{active:R.value}]),onClick:t[7]||(t[7]=e=>exec("linethrough"))},w,2),n(p,{modelValue:M.value,"onUpdate:modelValue":t[8]||(t[8]=e=>M.value=e),"show-alpha":"",predefine:I.value,size:"small",onChange:t[9]||(t[9]=e=>exec("color"))},null,8,["modelValue","predefine"]),n(p,{modelValue:H.value,"onUpdate:modelValue":t[10]||(t[10]=e=>H.value=e),"show-alpha":"",predefine:I.value,size:"small",onChange:t[11]||(t[11]=e=>exec("background"))},null,8,["modelValue","predefine"]),n(u,{modelValue:B.value,"onUpdate:modelValue":t[12]||(t[12]=e=>B.value=e),size:"small",style:{width:"100px","margin-right":"6px"},onChange:t[13]||(t[13]=e=>exec("lineHeight"))},{default:l((()=>[(d(),s(g,null,c(E,(e=>n(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])]),a("div",{class:"editorContainer",ref_key:"editorContainer",ref:h},null,512)])}}},[["__scopeId","data-v-61fb961d"]]);export{P as default};
